---
title: "Automatic Monitoring"
author: "Andr√© Menezes"
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

# Automatic Monitoring

The automatic monitoring method sequentially evaluate the forecasting activity to
detect breakdowns, based on Bayes factor. 

Again with the CP6 data, the automatic monitoring can be done using the 
`Monitoring` class. 

```{python fit-level-change-data}
a = np.array([600, 1])
R = np.array([[100, 0], [0, 25]])
mod = dlm(a, R, ntrend=2, deltrend=[0.90, 0.98])

# Fit with monitoring
monitor = Monitoring(mod=mod, bilateral=False)
fit_monitor = monitor.fit(y=cp6["sales"], h=4, tau=0.135, change_var=[100])
forecast_df = fit_monitor.get("filter").get("predictive")
```
```{r plot-fit-cp6-filter-monitor, echo=FALSE, fig.cap="Mean response for Filtered predictive distribution with $95\\%$ credibility interval", fig.dim=c(16,9), warnings = FALSE, out.width = "90%"}
df_cp6 <- py$cp6 %>% mutate(time = as.Date(time))

data_predictive = py$forecast_df 
data_predictive$time = df_cp6$time

data_predictive %>%
  ggplot(aes(x = time, y = y)) +
  geom_point(size = 3) +
  geom_line(aes(y = f), size = 0.8) +
  geom_ribbon(aes(ymin=ci_lower, ymax=ci_upper), 
              alpha=.25, colour = 'grey40') +
  scale_y_continuous(breaks = scales::pretty_breaks(10)) +
  scale_x_date(breaks = scales::pretty_breaks(8), date_labels = "%b/%Y") +
  theme(legend.position = "top") +
  xlab('Month/Year') + ylab('Sales') + 
  theme(axis.text=element_text(size=20), 
  axis.title=element_text(size=20)) +
  colorspace::scale_color_discrete_divergingx()
```
